(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{256:function(e,t,n){e.exports=n(497)},261:function(e,t,n){},494:function(e,t,n){},497:function(e,t,n){"use strict";n.r(t);var o=n(0),s=n.n(o),i=n(18),r=n.n(i),a=n(254),c=(n(261),n(3)),d=n(2),f=n(6),u=n(4),l=n(5),h=n(1),p=n(255),v=(n(10),function(){function e(t){Object(c.a)(this,e),this.onConnected=this.onConnected.bind(this),this.onDisconnected=this.onDisconnected.bind(this),this.beforeRequest=this.beforeRequest.bind(this),this.afterResponse=this.afterResponse.bind(this),this.onError=this.onError.bind(this),this.listener={onConnected:this.onConnected,onDisconnected:this.onDisconnected,beforeRequest:this.beforeRequest,afterResponse:this.afterResponse,onError:this.onError},this.wsClient=this.createWebSocketClient(t,this.listener),this.registeredListeners=[],this.registeredChangeListeners={}}return Object(d.a)(e,[{key:"call",value:function(e,t,n){this.wsClient.sendRequest(e,function(e){t(e)})}},{key:"isBusy",value:function(){return!this.isReady}},{key:"isReady",value:function(){return this.wsClient.isReady()}},{key:"addListener",value:function(e){this.registeredListeners.push(e)}},{key:"removeListener",value:function(e){for(var t=0;t<this.registeredListeners.length;t++)if(this.registeredListeners[t]===e){this.registeredListeners.splice(t,1);break}}},{key:"clearListeners",value:function(){this.registeredListeners=[]}},{key:"addChangeListener",value:function(e,t){this.registeredChangeListeners.hasOwnProperty(e)||(this.registeredChangeListeners[e]=[]),this.registeredChangeListeners[e].push(t)}},{key:"removeChangeListener",value:function(e,t){if(this.registeredChangeListeners.hasOwnProperty(e))for(var n=this.registeredChangeListeners[e],o=0;o<n.length;o++)if(n[o]===t){n.splice(o,1);break}}},{key:"clearChangeListeners",value:function(){this.registeredChangeListeners={}}},{key:"onConnected",value:function(){console.log("listener: onConnected"),this.registeredListeners.forEach(function(e){return e.onConnected()})}},{key:"onDisconnected",value:function(){console.log("listener: onDisconnected"),this.registeredListeners.forEach(function(e){return e.onDisconnected()})}},{key:"beforeRequest",value:function(e){this.registeredListeners.forEach(function(t){return t.beforeRequest(e)})}},{key:"afterResponse",value:function(e){if(this.registeredListeners.forEach(function(t){return t.afterResponse(e)}),e.changes)for(var t=0;t<e.changes.actions.length;t++){var n=e.changes.actions[t];for(var o in n)if(n.hasOwnProperty(o)){var s=this.registeredChangeListeners[o];if("undefined"!==typeof s&&Array.isArray(s))for(var i=0;i<s.length;i++)console.log("notify",n[o]),s[i](n[o])}}}},{key:"onError",value:function(e){console.log("listener: onError",e),this.registeredListeners.forEach(function(t){t.onError(e)})}},{key:"createWebSocketClient",value:function(e,t){var n,o,s=!1,i=1,r={};(n=new WebSocket(e)).onopen=function(e){s=!0,o=setInterval(a,15e3),c(e)},n.onclose=function(e){s=!1,clearInterval(o),d(e)},n.onmessage=function(e){f(e)},n.onerror=function(e){u(e)};var a=function(){l()&&(r["txid-0"]=function(){},n.send("{txId:0}"))},c=function(e){console.log("Connected."),"undefined"!==typeof t&&"function"===typeof t.onConnected&&t.onConnected()},d=function(e){console.log("Connection closed."),"undefined"!==typeof t&&"function"===typeof t.onDisconnected&&t.onDisconnected()},f=function(e){var n=p.a.deserialize(JSON.parse(e.data));console.log("onMessage",n);var o="txid-"+n.txId,s=r[o];"function"===typeof s?(s(n),delete r[o]):console.log("WARN: msgCallback not defined!"),"undefined"!==typeof t&&"function"===typeof t.afterResponse&&t.afterResponse(n)},u=function(e){console.log("WebSocket error occurred."),r={},"undefined"!==typeof t&&"function"===typeof t.onError&&t.onError("WebSocket error!")},l=function(){return n&&s};return{isReady:l,send:function(e,o){if(!l())throw new Error("WebSocket not ready.");var s=i++,a={txId:s,action:e};"function"===typeof o&&(r["txid-"+s]=o),"undefined"!==typeof t&&"function"===typeof t.beforeRequest&&t.beforeRequest(s),n.send(JSON.stringify(a))},sendRequest:function(e,o){if(!l())throw new Error("WebSocket not ready.");"function"===typeof o&&(r["txid-"+e.txId]=o),"undefined"!==typeof t&&"function"===typeof t.beforeRequest&&t.beforeRequest(e.txId),n.send(JSON.stringify(e))}}}}]),e}()),k=n(190),y=n(12),g=n(57),b=(n(493),n(494),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(f.a)(this,Object(u.a)(t).call(this,e))).state={presentation:!1},n.service=new v(n.props.wsUri),n.setEditMode=n.setEditMode.bind(Object(h.a)(Object(h.a)(n))),n.setPresentationMode=n.setPresentationMode.bind(Object(h.a)(Object(h.a)(n))),n}return Object(l.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.openWorkbookAfterServiceReady()}},{key:"openWorkbookAfterServiceReady",value:function(){var e=this;this.service.isReady()?this.openWorkbook():setTimeout(function(){return e.openWorkbookAfterServiceReady()},100)}},{key:"openWorkbook",value:function(){var e=this,t=new y.a;t.openWorkbook=new g.a,this.service.call({txId:0,action:t},function(t){console.log("open workbook",t),0===t.statusCode&&e.setState({workbook:t.workbook})})}},{key:"setEditMode",value:function(){this.setState({presentation:!1})}},{key:"setPresentationMode",value:function(){this.setState({presentation:!0})}},{key:"render",value:function(){return s.a.createElement("div",{className:"wrapper"},s.a.createElement("div",{className:"header"},s.a.createElement("ul",null,s.a.createElement("li",{className:this.state.presentation?"":"selected"},s.a.createElement("a",{href:"javascript:void(0);",onClick:this.setEditMode},"\u7f16\u8f91\u6a21\u5f0f")),s.a.createElement("li",{className:this.state.presentation?"selected":""},s.a.createElement("a",{href:"javascript:void(0);",onClick:this.setPresentationMode},"\u5c55\u793a\u6a21\u5f0f")))),s.a.createElement("div",{className:"content"},this.renderContent()))}},{key:"renderContent",value:function(){var e=this.state.workbook;return"undefined"!==typeof e?this.state.presentation?s.a.createElement(k.b,{workbook:e,service:this.service}):s.a.createElement(k.a,{workbook:e,service:this.service}):s.a.createElement("div",{className:"loading"},"Loading...")}}]),t}(o.Component));b.defaultProps={wsUri:"ws://"+window.location.host+"/wsapi"};var C=b;r.a.render(s.a.createElement(a.a,null,s.a.createElement(C,null)),document.getElementById("root"))}},[[256,1,2]]]);
//# sourceMappingURL=main.e7af221e.chunk.js.map